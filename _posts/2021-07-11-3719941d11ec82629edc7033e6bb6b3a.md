---
title:  ğŸˆNest.js ê¸°ë³¸ì½”ë“œ êµ¬ì¡°

subtitle:  One Language Full Stack
categories: íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ 
tags: nestjs  backend
 
---

  
### <main.ts>  
  
import { ValidationPipe } from â€˜@nestjs/commonâ€™;  
import { NestFactory } from â€˜@nestjs/coreâ€™;  
import { AppModule } from â€˜./app.moduleâ€™;  
  
async function bootstrap() {  
  const app = await NestFactory.create(AppModule);  
  app.useGlobalPipes(new ValidationPipe());    // ì¶”ê°€  
  await app.listen(3000);  
}  
bootstrap();  
### ë³´ì¼ëŸ¬ í”Œë ˆì´íŠ¸ë¥¼ í†µí•´ ìƒì„±í•œ ê¸°ë³¸ í¬ë§·ì— ì¤‘ê°„ì— íŒŒì´í”„ê°€ í•˜ë‚˜ ì¶”ê°€ë˜ì—ˆë‹¤.  
  
### íŒŒì´í”„ëŠ” expressì˜ ë¯¸ë“¤ì›¨ì–´ê°™ì€ ê°œë…ìœ¼ë¡œ ëª¨ë“  ìš”ì²­ë§ˆë‹¤ ì „ì²˜ë¦¬ëœë‹¤.  
  
### ì‹¤ì œì˜ main ì—­í• ì€ app moduleë¥¼ ì‚´í´ë´ì•¼ í•œë‹¤.  
  
  
  
### <app.module.ts>  
  
import { Module } from â€˜@nestjs/commonâ€™;  
import { ConfigModule } from â€˜@nestjs/configâ€™;  
import { GraphQLModule } from â€˜@nestjs/graphqlâ€™;  
import { TypeOrmModule } from â€˜@nestjs/typeormâ€™;  
import { RestaurantsModule } from â€˜./restaurants/restaurants.moduleâ€™;  
import { Restaurant } from â€˜./restaurants/entities/restaurant.entityâ€™;  
import * as Joi from â€˜joiâ€™;  
  
@Module({  
  imports: [  
    ConfigModule.forRoot({  
      isGlobal: true,  
      envFilePath: process.env.NODE_ENV === â€˜devâ€™ ? â€˜.env.devâ€™ : â€˜.env.testâ€™,  
      ignoreEnvFile: process.env.NODE_ENV === â€˜prodâ€™,  
      validationSchema: Joi.object({  
        NODE_ENV: Joi.string().valid(â€˜devâ€™, â€˜prodâ€™),  
        DB_HOST: Joi.string().required(),  
        DB_PORT: Joi.string().required(),  
        DB_USERNAME: Joi.string().required(),  
        DB_PASSWORD: Joi.string().required(),  
        DB_NAME: Joi.string().required(),  
      }),  
    }),  
    TypeOrmModule.forRoot({  
      type: â€˜postgresâ€™,  
      host: process.env.DB_HOST,  
      port: +process.env.DB_PORT,    // +ê°€ ë¶™ì€ ê²ƒì€ ë¬¸ìì—´ì„ ìˆ«ìë¡œ ë°”ê¾¼ë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤  
      username: process.env.DB_USERNAME,  
      password: process.env.DB_PASSWORD,  
      database: process.env.DB_NAME,  
      synchronize: process.env.NODE_ENV !== â€˜prodâ€™, // entityì— ìˆ˜ì •ì´ ìƒê¸°ë©´ typeormì„ í†µí•´ DBì— ìë™ì ìš©(migration)  
      logging: process.env.NODE_ENV !== â€˜prodâ€™,  
      entities: [Restaurant], // ì—¬ê¸°ì— ì¶”ê°€í•˜ë©´ Restaurantì´ë¼ëŠ” entityê°€ DBì—ë„ ìƒì„±ëœë‹¤  
    }),  
    GraphQLModule.forRoot({  
      autoSchemaFile: true,  
    }),  
    RestaurantsModule,  
  ],  
  controllers: [],  
  providers: [],  
})  
export class AppModule {}  
### app moduleì—ì„œëŠ” ì„¸ ê°€ì§€ ìš”ì†Œë¥¼ ì±„ì›Œ ë„£ì–´ì•¼ í•˜ëŠ”ë°,  
  
### imports, controller, providers ë°°ì—´ì´ë‹¤.  
  
### @Module ë°ì½”ë ˆì´í„°ì˜ ìš”ì†Œë¡œ ì±„ì›Œ ë„£ëŠ”ë‹¤.  
  
  
  
### importsì— ì¶”ê°€ëœ ìš”ì†ŒëŠ”,  
  
### APIì— ëŒ€í•œ requestì˜ íŒŒë¼ë©”í„°ë¥¼ ê²€ì‚¬í•˜ëŠ” ConfigModuleê³¼ joi,  
  
### Databaseì— ëŒ€í•œ TypeORM,  
  
### GraphQL ì‚¬ìš©ì„ ìœ„í•œ ëª¨ë“ˆ,  
  
### ê·¸ë¦¬ê³  ì‚¬ìš©ìê°€ ì§ì ‘ ë§Œë“  ë ˆìŠ¤í† ë‘ ëª¨ë“ˆ ë“±ì´ë‹¤.  
  
  
  
### ëª¨ë“ˆ, ì»¨íŠ¸ë¡¤ëŸ¬, í”„ë¡œë°”ì´ë”ê°€ í•˜ëŠ”ì¼ì€ ì´ì „ í¬ìŠ¤íŠ¸ë¥¼ ì°¸ê³ í•˜ì.  
  
  
  
### <restaurants.module.ts>  
  
import { Module } from â€˜@nestjs/commonâ€™;  
import { TypeOrmModule } from â€˜@nestjs/typeormâ€™;  
import { Restaurant } from â€˜./entities/restaurant.entityâ€™;  
import { RestraurantsResolver } from â€˜./restaurants.resolverâ€™;  
import { RestaurantService } from â€˜./restaurants.serviceâ€™;  
  
@Module({  
  imports: [TypeOrmModule.forFeature([Restaurant])],  
  providers: [RestraurantsResolver, RestaurantService],  
})  
export class RestaurantsModule {}  
### ì´ì œ ë³¸ê²©ì ìœ¼ë¡œ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì˜ ì‘ì„±ì´ë‹¤.  
  
### entityë¡œëŠ” Restaurant, Serviceë¡œëŠ” RestaurantResolver, RestaurantServiceë¥¼ ë“±ë¡í•˜ì˜€ë‹¤.  
  
### (ë“±ë¡ì€ ìš”ì‹í–‰ìœ„ê°€ ì•„ë‹ˆë‹¤. ì´ë ‡ê²Œ ë“±ë¡ì„ í•´ì£¼ë©´ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì—°ê²°í•˜ì—¬ DIë¥¼ í•  ìˆ˜ ìˆë„ë¡ í•´ì¤€ë‹¤)  
  
  
  
import { Field, ObjectType } from â€˜@nestjs/graphqlâ€™;  
import { IsBoolean, IsOptional, IsString, Length } from â€˜class-validatorâ€™;  
import { Column, Entity, PrimaryGeneratedColumn } from â€˜typeormâ€™;  
  
@ObjectType()  
@Entity()  
export class Restaurant {  
  @PrimaryGeneratedColumn()  
  @Field((type) => Number)  
  id: number;  
  
  @Field((type) => String)    // For GraphQL  
  @Column()    // For TypeORM  
  @IsString()    // For Validation  
  @Length(5, 10)  
  name: string;    // Entity  
  
  @Field((type) => Boolean, { defaultValue: true })  
  @Column({ default: true })  
  @IsBoolean()  
  @IsOptional()  
  isVegan?: boolean;  
  
  @Field((type) => String)  
  @Column()  
  @IsString()  
  address: string;  
  
  @Field((type) => String)  
  @Column()  
  @IsString()  
  ownersName: string;  
}  
### í•˜ë‚˜ì˜ ì—”í‹°í‹°ë¥¼ í†µí•´ GraphQL Schema, TypeORM model, ìœ íš¨ì„± ê²€ì¦, ë‚˜ì¤‘ì—ëŠ” DTOì— í™œìš©ê¹Œì§€ ì—¬ëŸ¬ê°€ì§€ë¥¼ í•œë²ˆì— í•  ìˆ˜ ìˆë‹¤.  
  
### ë°ì½”ë ˆì´í„°ë¥¼ ì‚´í´ë³´ë©´ ì–´ë µì§€ ì•Šê²Œ ì˜ë¯¸ë¥¼ ì•Œ ìˆ˜ ìˆë‹¤.  
  
  
  
### <restauratn.resolver.ts>  
  
import { Args, Mutation, Query, Resolver } from â€˜@nestjs/graphqlâ€™;  
import { argsToArgsConfig } from â€˜graphql/type/definitionâ€™;  
import { number } from â€˜joiâ€™;  
import { CreateRestaurantDto } from â€˜./dto/create-restaurant.dtoâ€™;  
import { UpdateRestaurantDto } from â€˜./dto/update-restaurant.dtoâ€™;  
import { Restaurant } from â€˜./entities/restaurant.entityâ€™;  
import { RestaurantService } from â€˜./restaurants.serviceâ€™;  
  
@Resolver((of) => Restaurant)    // Restaurant entity(schema)ì— ëŒ€í•œ resolver ì •ì˜  
export class RestraurantsResolver {  
  constructor(private readonly restaurantService: RestaurantService) {}    // Service ê°ì²´ ì£¼ì…  
  
  @Query(() => [Restaurant])  
  restaurants(): Promise<Restaurant[]> {  
    return this.restaurantService.getAll();  
  }  
  
  @Mutation((returns) => Boolean)  
  async createRestaurant(  
    @Args(â€˜inputâ€™) createRestaurantDto: CreateRestaurantDto,  
  ): Promise<boolean> {  
    try {  
      await this.restaurantService.createRestaurant(createRestaurantDto);  
      return true;  
    } catch (e) {  
      console.log(e);  
      return false;  
    }  
  }  
  
  @Mutation((returns) => Boolean)  
  async updateRestaurant(  
    @Args(â€˜inputâ€™) updateRestaurantDto: UpdateRestaurantDto,  
  ): Promise<boolean> {  
    try {  
      await this.restaurantService.updateRestaurant(updateRestaurantDto);  
      return true;  
    } catch (e) {  
      console.log(e);  
      return false;  
    }  
  }  
}  
### GraphQL ìŠ¤í‚¤ë§ˆë¥¼ ëª¨ë¸ì—ì„œ ì†ì‰½ê²Œ ì •ì˜í–ˆìœ¼ë‹ˆ, ê·¸ì— ëŒ€í•œ resolverë¥¼ ì •ì˜í•´ë³´ì.  
  
### ìƒì„±ìë¥¼ ìš°ì„  ì£¼ëª©í•´ì„œ ë´ë³´ì.  
  
### ìƒì„±ìë¡œ ì„œë¹„ìŠ¤ë¥¼ ì €ë ‡ê²Œ ë°›ëŠ”ë‹¤ê³  í•´ë„ ëˆ„êµ°ê°€ ë„£ì–´ì£¼ì§€ ì•ŠëŠ”ë‹¤ë©´ ì‹¤ì œë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.  
  
  
  
### ì‹¤ì œ í•µì‹¬ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ëŠ” ì„œë¹„ìŠ¤ì—ì„œ êµ¬í˜„í•˜ê³ ,  
  
### ì„œë¹„ìŠ¤ì—ì„œëŠ” TypeORMì„ í†µí•´ ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•˜ì—¬ resolverì—ì„œ í•„ìš”í•œ ê°’ì„ ì²˜ë¦¬í•œë‹¤.  
  
  
  
### TypeORMì—ì„œì˜ ë°˜í™˜ í˜•ì‹ì´ Promiseì´ê¸° ë•Œë¬¸ì—, Resolverì˜ ë°˜í™˜ê°’ ì—­ì‹œ Promiseì´ë‹¤.  
  
### ê·¸ë¦¬ê³  íŒŒë¼ë©”í„°ë¡œ ì“°ì´ëŠ” DTOì— ëŒ€í•´ì„œëŠ”,  
  
[image:3C63D8E2-4D09-4F20-A3BB-F7D4ABCB04CE-792-000079446C4B6F5A/dthumb-phinf.pstatic.net.png]  
### DTOì™€ VOë€?   
###  ì˜¤ëŠ˜ì€ DTOì— ê´€í•˜ì—¬ í¬ìŠ¤íŒ… í•œë‹¤. DTOëŠ” Data Transfer Objectì˜ ì•½ìë¡œì„œ, VO ( Value Object )ë‘ í˜¼ìš©í•´ì„œ ì“´ë‹¤. ë³´í†µì€ DTOì™€ VOë¥¼ í˜¼ìš©í•´ì„œ ì‚¬ìš©ë“¤ í•˜ì§€ë§Œ, í•„ìëŠ” ìš©ì–´ë¥¼ ì •í™•íˆ êµ¬ë¶„í•´ì„œ ì“°ëŠ”ê±¸ ì¤‘ìš”í•˜ë‹¤..   
###  mommoo.tistory.com  
  
[DTOì™€ VOë€?](https://mommoo.tistory.com/61)  
  
[ì˜¤ëŠ˜ì€ DTOì— ê´€í•˜ì—¬ í¬ìŠ¤íŒ… í•œë‹¤. DTOëŠ” Data Transfer Objectì˜ ì•½ìë¡œì„œ, VO ( Value Object )ë‘ í˜¼ìš©í•´ì„œ ì“´ë‹¤. ë³´í†µì€ DTOì™€ VOë¥¼ í˜¼ìš©í•´ì„œ ì‚¬ìš©ë“¤ í•˜ì§€ë§Œ, í•„ìëŠ” ìš©ì–´ë¥¼ ì •í™•íˆ êµ¬ë¶„í•´ì„œ ì“°ëŠ”ê±¸ ì¤‘ìš”í•˜ë‹¤..](https://mommoo.tistory.com/61)  
  
[mommoo.tistory.com](https://mommoo.tistory.com/61)  
  
  
### <create-restaurant.dto.ts>  
  
import { Field, InputType, OmitType } from â€˜@nestjs/graphqlâ€™;  
import { IsBoolean, IsString, Length } from â€˜class-validatorâ€™;  
import { Restaurant } from â€˜../entities/restaurant.entityâ€™;  
  
@InputType()  
export class CreateRestaurantDto extends OmitType(  
  Restaurant,  
  [â€˜idâ€™],  
  InputType,  
) {}  
//  {  
//   @Field((type) => String)  
//   @IsString()  
//   @Length(5, 10)  
//   name: string;  
  
//   @Field((type) => Boolean)  
//   @IsBoolean()  
//   isVegan: boolean;  
  
//   @Field((type) => String)  
//   @IsString()  
//   address: string;  
  
//   @Field((type) => String)  
//   @IsString()  
//   ownersName: string;  
// }  
### ì£¼ì„ì²˜ë¦¬í•œê²ƒì²˜ëŸ¼ ì§ì ‘ ë§Œë“¤ìˆ˜ë„ ìˆì§€ë§Œ, ê¸°ì¡´ì— ë§Œë“  entityì—ì„œ íŠ¹ì • í•„ë“œë¥¼ ì œì™¸í•œë˜ì§€í•´ì„œ DTOë¥¼ ì‰½ê²Œ ë§Œë“¤ ìˆ˜ ìˆë‹¤.  
  
  
  
### <update-restaurant.dto.ts>  
  
import {  
  ArgsType,  
  Field,  
  InputType,  
  
  PartialType,  
} from â€˜@nestjs/graphqlâ€™;  
import { CreateRestaurantDto } from â€˜./create-restaurant.dtoâ€™;  
  
@InputType()  
export class UpdateRestaurantInputType extends PartialType(  
  CreateRestaurantDto,  
) {}  
  
@ArgsType()  
export class UpdateRestaurantDto {  
  @Field((type) => Number)  
  id: number;  
  
  @Field((type) => UpdateRestaurantInputType)  
  data: UpdateRestaurantInputType;  
}  
### ì´ë¯¸ ë§Œë“  CreateRestaurantDtoë¥¼ ì´ìš©í•´ ìœ„ì²˜ëŸ¼ DTOë¥¼ ë§Œë“¤ ìˆ˜ë„ ìˆë‹¤.  
  
### ë§ˆì§€ë§‰ìœ¼ë¡œ ì œì¼ ì¤‘ìš”í•˜ë‹¤ê³  í•  ìˆ˜ ìˆëŠ” ì„œë¹„ìŠ¤ì´ë‹¤.  
  
  
  
### <restaurant.service.ts>  
  
import { Injectable } from â€˜@nestjs/commonâ€™;  
import { InjectRepository } from â€˜@nestjs/typeormâ€™;  
import { Repository } from â€˜typeormâ€™;  
import { CreateRestaurantDto } from â€˜./dto/create-restaurant.dtoâ€™;  
import { UpdateRestaurantDto } from â€˜./dto/update-restaurant.dtoâ€™;  
import { Restaurant } from â€˜./entities/restaurant.entityâ€™;  
  
@Injectable()    // ì¤‘ìš”  
export class RestaurantService {  
  constructor(  
    @InjectRepository(Restaurant)    // repositoryë¥¼ ì£¼ì…  
    private readonly restaurants: Repository<Restaurant>,  
  ) {}  
  
  getAll(): Promise<Restaurant[]> {  
    return this.restaurants.find();  
  }  
  
  createRestaurant(  
    createRestaurantDto: CreateRestaurantDto,  
  ): Promise<Restaurant> {  
    const newRestaurant = this.restaurants.create(createRestaurantDto);  
    return this.restaurants.save(newRestaurant);  
  }  
  
  updateRestaurant({ id, data }: UpdateRestaurantDto) {  
    return this.restaurants.update(id, { â€¦data });  
  }  
}  
### TypeORMì„ í†µí•´ DBë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ë°©ì‹ì€,  
  
### Active Record íŒ¨í„´ê³¼ Data Mapper ë°©ì‹ì´ ìˆëŠ”ë° Nest.jsëŠ” í›„ìë¥¼ ì‚¬ìš©í•˜ê³  ìˆë‹¤.  
  
### ì „ìê°€ ë” ì§ê´€ì ì¼ìˆ˜ë„ ìˆì§€ë§Œ í° ì°¨ì´ëŠ” ì—†ì–´ë³´ì¸ë‹¤.  
  
  
  
### Data Mapper ë°©ì‹ì€ Repository ê°ì²´ë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì ‘ê·¼í•œë‹¤.  
  
### ìƒì„±ìë¥¼ ì£¼ëª©í•´ì„œ ë´ë³´ì. ì—­ì‹œë‚˜ Repositoryê°€ ì£¼ì…ëœë‹¤.  
  
### í´ë˜ìŠ¤ ë‚´ì—ì„œ ììœ ë¡­ê²Œ Repositoryë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.  
  
  
  
### Repositoryë¥¼ í†µí•´ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì„ êµ¬í˜„í•´ì„œ Resolverë‚˜ Mutationì—ê²Œ ê°’ì„ ì „ë‹¬í•œë‹¤.  
  
  
  
### <ì°¸ê³  í”„ë¡œì íŠ¸>  
  
### https://github.com/develup4/Practice-UberClone  
  
[https://github.com/develup4/Practice-UberClone](https://github.com/develup4/Practice-UberClone)  
  
[image:93305D2E-1DEB-4EAB-87D9-940CA037EE5E-792-000079446C0CE721/dthumb-phinf.pstatic.net.png]  
### develup4/Practice-UberClone   
###  https://nomadcoders.co/nuber-eats/. Contribute to develup4/Practice-UberClone development by creating an account on GitHub.   
###  github.com  
  
[develup4/Practice-UberClone](https://github.com/develup4/Practice-UberClone)  
  
[https://nomadcoders.co/nuber-eats/. Contribute to develup4/Practice-UberClone development by creating an account on GitHub.](https://github.com/develup4/Practice-UberClone)  
  
[github.com](https://github.com/develup4/Practice-UberClone)  
  
  
  
