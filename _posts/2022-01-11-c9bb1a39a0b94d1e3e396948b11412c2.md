---
title:  ğŸƒâ€â™€ï¸CompletableFuture

subtitle:  Java 8
categories: java 
tags: concurrent  executor  callable  future
 
toc: true
toc_sticky: true
---

  
  
  
  
# 2. Executors  
## : Runnableì´ë‚˜ Threadì™€ ê°™ì€ Low-levelì´ì•„ë‹Œ ê³  ìˆ˜ì¤€(High-Level) Concurrency í”„ë¡œê·¸ë˜ë°  
## ìš°ë¦¬ê°€ Runnableë§Œ ì •ì˜í•´ì„œ ì œê³µí•´ì£¼ë©´ ìŠ¤ë ˆë“œë¥¼ ë§Œë“¤ê³ , ë¶ˆí•„ìš”í•´ì§€ë©´ ì¢…ë£Œí•˜ê³  ê´€ë¦¬í•´ì£¼ëŠ” ì‘ì—…ë“¤ì„ ëŒ€ì‹  í•´ì£¼ëŠ” í´ë˜ìŠ¤  
# Executorsê°€ í•˜ëŠ” ì¼  
# *   
## ì“°ë ˆë“œ ë§Œë“¤ê¸°: ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‚¬ìš©í•  ì“°ë ˆë“œ í’€ì„ ë§Œë“¤ì–´ê´€ë¦¬í•œë‹¤.  
# *   
## ì“°ë ˆë“œ ê´€ë¦¬: ì“°ë ˆë“œ ìƒëª… ì£¼ê¸°ë¥¼ ê´€ë¦¬í•œë‹¤.  
# *   
## ì‘ì—… ì²˜ë¦¬ ë° ì‹¤í–‰: ì“°ë ˆë“œë¡œ ì‹¤í–‰í•  ì‘ì—…ì„ ì œê³µí•  ìˆ˜ ìˆëŠ” APIë¥¼ ì œê³µí•œë‹¤.  
# ì£¼ìš” ì¸í„°í˜ì´ìŠ¤  
# *   
## Executor:  execute(Runnable)  
# *   
## ExecutorService: Executorë¥¼ ìƒì† ë°›ì€ ì¸í„°í˜ì´ìŠ¤ë¡œ, Callableë„ ì‹¤í–‰ ê°€ëŠ¥í•˜ë©° Executorë¥¼ ì¢…ë£Œ ì‹œí‚¤ê±°ë‚˜ ì—¬ëŸ¬  Callableì„ ë™ì‹œì— ì‹¤í–‰í•˜ëŠ” ë“±ì˜ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.  
# *   
## ScheduledExecutorService: ExecutorServiceë¥¼ ìƒì† ë°›ì€ ì¸í„°í˜ì´ìŠ¤ë¡œ íŠ¹ì • ì‹œê°„ ì´í›„ì— ë˜ëŠ” ì£¼ê¸°ì ìœ¼ë¡œ ì‘ì—… ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.  
# ì˜ˆì œ  
# *   
## ê¸°ë³¸ ì‚¬ìš© ì˜ˆì œ  
public static void main(String[] args) throws InterruptedException {  
    ExecutorService executorService = Executors.newSingleThreadExecutor();  
      
    //Legacy case  
    executorService.execute(new Runnable() {  
        @Override  
        public void run() {  
            System.out.println("Thread: "+Thread.currentThread().getName());  
        }  
    });  
    //Lambda Expression  
    executorService.submit(()->{  
        System.out.println("Lambda Expression Thread: "+Thread.currentThread().getName());  
    });  
  
    executorService.shutdown(); //graceful shutdown  
    //executorService.shutdownNow(); //ì¦‰ì‹œ ì¢…ë£Œ  
}  
Java  
# *   
## 2ê°œì˜ Threadë¥¼ ì´ìš©í•˜ì—¬ ì‹¤í–‰  
public class App {  
    private static Runnable getRunnable(String message) {  
        return ()->System.out.println(message + Thread.currentThread().getName());  
    }  
  
    public static void main(String[] args) throws InterruptedException {  
        ExecutorService executorService = Executors.newFixedThreadPool(2);  
  
        executorService.submit(getRunnable("Hello"));  
        executorService.submit(getRunnable("World"));  
        executorService.submit(getRunnable("The"));  
        executorService.submit(getRunnable("Java"));  
        executorService.submit(getRunnable("Lecture"));  
        executorService.submit(getRunnable("Concurrent"));  
        executorService.submit(getRunnable("Part"));  
  
        executorService.shutdown(); //graceful shutdown  
    }  
}  
Java## [ì‹¤í–‰ ê²°ê³¼]  
## 1.  
## Executors.newFixedThreadPool(2)  
## â‡’ í•´ë‹¹ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ë©´ í•´ë‹¹ ì˜ì—­ì—ëŠ” ì¸ìê°’ìœ¼ë¡œ ë„˜ê²¨ì¤€ ìˆ«ìë§Œí¼ Threadë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤. ìœ„ ì½”ë“œì—ì„œëŠ” 2ë¥¼ ì¸ìê°’ìœ¼ë¡œ ë„˜ê²¨ì¤¬ê¸° ë•Œë¬¸ì— 2ê°œì˜ 2ê°œì˜ ì“°ë ˆë“œë¥¼ ê´€ë¦¬í•˜ëŠ” Thread Poolì´ ë„ëŠ”ë™ì•ˆ Blocking Queueì— ë“±ë¡ëœ ì‘ì—…ë“¤ì´ ì°¨ë¡€ëŒ€ë¡œ ë™ì‘í•©ë‹ˆë‹¤.  
  
![]({{ site.url }}{{ site.baseurl }}/assets/images/c9bb1a39a0b94d1e3e396948b11412c2/image.png)  
# *   
## ExecutorService.newSingleThreadScheduledExcutor();  
ScheduledExecutorService executorService = Executors.newSingleThreadScheduledExecutor();  
executorService.scheduleAtFixedRate(getRunnable("hello"), 3, 1, TimeUnit.SECONDS);  
Java## 1.  
## scheduleAtFixedRate(ì‹¤í–‰ Runnable, ì‹œì‘ ì§€ì—° ì‹œê°„, ë”œë ˆì´, íŒŒë¼ë¯¸í„° ì‹œê°„ ë‹¨ìœ„)  
## â‡’ ìœ„ ì½”ë“œì—ì„œëŠ” Runnableíƒ€ì…ì„ ë°˜í™˜í•˜ëŠ” getRunnable() ë©”ì†Œë“œë¥¼ í”„ë¡œê·¸ë¨ì´ ì‹œì‘ í›„ 3ì´ˆ ë’¤ë¶€í„° 1ì´ˆë§ˆë‹¤ ìˆ˜í–‰í•˜ëŠ” ì½”ë“œì…ë‹ˆë‹¤.  
# 3. Callableê³¼ Future  
  
# Callable  
# *   
## Runnableê³¼ ê±°ì˜ ìœ ì‚¬í•˜ì§€ë§Œ ë°˜í™˜ê°’ì„ ê°€ì§ˆ ìˆ˜ ìˆë‹¤.  
# *   
## get() ë©”ì†Œë“œë¥¼ í†µí•´ ê°’ì„ ë°˜í™˜ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
# â—¦  
## í•´ë‹¹ ë©”ì†Œë“œëŠ” ë¸”ë¡í‚¹ ì½œì´ê¸°ì— ë©”ì†Œë“œ í˜¸ì¶œì‹œì ë¶€í„° ì½”ë“œì‹¤í–‰ ì™„ë£Œê¹Œì§€ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.  
# â—¦  
## íƒ€ì„ì•„ì›ƒì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
ExecutorService executorService = Executors.newSingleThreadExecutor();  
Callable<String> hello = () ->{  
    Thread.sleep(2000L);  
    return "Hello";  
};  
Future<String> submit = executorService.submit(hello);  
System.out.println("Started!");  
  
submit.get();//blocking  
  
System.out.println("End");  
executorService.shutdown();  
Java## [ì‹¤í–‰ ê²°ê³¼]  
# *   
## isDone()ë©”ì†Œë“œë¥¼ í†µí•´ ì‘ì—… ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
ExecutorService executorService = Executors.newSingleThreadExecutor();  
Callable<String> hello = () ->{  
    Thread.sleep(2000L);  
    return "Hello";  
};  
Future<String> helloFuture = executorService.submit(hello);  
System.out.println(helloFuture.isDone());  
System.out.println("Started!");  
  
helloFuture.get();//blocking  
  
System.out.println(helloFuture.isDone());  
System.out.println("End");  
executorService.shutdown();  
Java## [ì‹¤í–‰ ê²°ê³¼]  
get()## ì„ í˜¸ì¶œí•˜ê¸°ì „ì—ëŠ”  
isDone()## ì´  
false## ë¡œ ì•„ì§ ìˆ˜í–‰ë˜ì§€ ì•Šì€ê±¸ ì•Œ ìˆ˜ ìˆê³ ,  
get()## í˜¸ì¶œ ì´í›„ ì‹œì ì—ì„œëŠ”  
isDone()## ì´  
true## ì¸ê±¸ë¡œ ì™„ë£Œë˜ì—ˆë‹¤ëŠ”ì‚¬ì‹¤ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
# *   
## cancel() ë©”ì†Œë“œë¡œ ì‘ì—…ì„ ì·¨ì†Œí•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.   
## â‡’ ì¸ìê°’ìœ¼ë¡œ í˜„ì¬ ì§„í–‰ì¤‘ì¸ ì“°ë ˆë“œ interrupt ì—¬ë¶€ë¥¼ ê²°ì •í•©ë‹ˆë‹¤. trueë©´ í˜„ì¬ ì§„í–‰ì¤‘ì¸ ì“°ë ˆë“œë¥¼ interruptí•˜ê³  ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ í˜„ì¬ ì§„í–‰ì¤‘ì¸ ì‘ì—…ì´ ëë‚ ë•Œê¹Œì§€ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.  
ExecutorService executorService = Executors.newSingleThreadExecutor();  
Callable<String> hello = () ->{  
    Thread.sleep(2000L);  
    return "Hello";  
};  
Future<String> helloFuture = executorService.submit(hello);  
System.out.println(helloFuture.isDone());  
System.out.println("Started!");  
  
helloFuture.cancel(false);  
  
System.out.println(helloFuture.isDone());  
System.out.println("End");  
  
helloFuture.get();  
executorService.shutdown();  
Java## [ì‹¤í–‰ ê²°ê³¼]  
## 1.  
## helloFuture.cancel(false)  
## â‡’ í˜„ì¬ ì§„í–‰ì¤‘ì¸ ì‘ì—…ì„ ê¸°ë‹¤ë¦° ë’¤ ì‘ì—…ì„ ì·¨ì†Œí•©ë‹ˆë‹¤. ì‘ì—…ì„ ì·¨ì†Œë˜ì–´ ì¢…ë£Œë˜ì—ˆê¸° ë•Œë¬¸ì— ë°‘ì—  
helloFuture.isDone()## ì€  
true## ê°€ ë°˜í™˜ë˜ë©°, ì´ë¯¸ ì·¨ì†Œí•œ ì‘ì—…ì„  
get()## í˜¸ì¶œí•˜ëŠ” ì‹œì ì—ëŠ”  
CancellationException## ì˜ˆì™¸ê°€ ë°œìƒí•©ë‹ˆë‹¤.  
# *   
## invokeAll() ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•´ ì—¬ëŸ¬ ì‘ì—…ë“¤ì„ ë™ì‹œì— ì‹¤í–‰í• ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.  
ExecutorService executorService = Executors.newSingleThreadExecutor();  
LocalDateTime start = LocalDateTime.now();  
Callable<String> hello = () ->{  
    Thread.sleep(2000L);  
    return "Hello";  
};  
Callable<String> java = () ->{  
    Thread.sleep(3000L);  
    return "java";  
};  
Callable<String> catsbi = () ->{  
    Thread.sleep(1000L);  
    return "catsbi";  
};  
  
List<Future<String>> futures =   
        executorService.invokeAll(Arrays.asList(hello, java, catsbi));  
for (Future<String> future : futures) {  
    System.out.println(future.get());  
}  
LocalDateTime end = LocalDateTime.now();  
Duration between = Duration.between(start, end);  
System.out.println(between.getSeconds());  
Java## [ì‹¤í–‰ ê²°ê³¼]  
## 1.  
## ì¶œë ¥ ê²°ê³¼  
## â‡’ 1ì´ˆ,2ì´ˆ, 3ì´ˆì§œë¦¬ Callbable ë“¤ì´ ìˆ˜í–‰ë˜ë©° ì°¨ë¡€ëŒ€ë¡œ ì¶œë ¥ë˜ëŠ”ê²Œ ì•„ë‹Œ ì „ì²´ê°€ ëë‚ ë•Œê¹Œì§€ ê¸°ë‹¤ë ¸ë‹¤ê°€ í•œ ë²ˆì— ì¶œë ¥ë˜ì—ˆìŠµë‹ˆë‹¤. ê·¸ ì´ìœ ëŠ” invokeAll()ì—ì„œëŠ” ì–´ëŠ í•˜ë‚˜ì˜ ì‘ì—…ì´ ëë‚˜ë”ë¼ë„ ë‹¤ë¥¸ ì‘ì—…ì´ ëë‚ ë•Œê¹Œì§€ ê¸°ë‹¤ë ¸ë‹¤ê°€ ëª¨ë“  ì‘ì—…ì´ ëë‚˜ë©´ ê²°ê³¼ë¥¼ ê°€ì ¸ì˜¤ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.   
## 2.  
## between.getSeconds()  
## â‡’ 1ì´ˆ, 2ì´ˆ, 3ì´ˆ ì§œë¦¬ ì‘ì—…ì„ ê°ê° ìˆ˜í–‰í•˜ë©° ëë‚ ë•Œê¹Œì§€ ê¸°ë‹¤ë ¸ë‹¤ê°€ ì¶œë ¥í•˜ëŠ”ë°, cuncurrencyí•˜ë‹¤ë©´ ê°€ì¥ ê¸´ ì‘ì—…ì‹œê°„ì¸ 3ì´ˆê°€ ì§€ë‚¬ì„ë•Œ ëª¨ë“  ì‘ì—…ì´ ëë‚˜ì•¼ í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì¶œë ¥ê²°ê³¼ëŠ” 6ì´ˆì˜€ìŠµë‹ˆë‹¤. ê·¸ ì´ìœ ëŠ” ExecutorServiceì— í• ë‹¹ëœ threadê°€ ì‹±ê¸€ì“°ë ˆë“œì´ê¸° ë•Œë¬¸ì— ë‚´ë¶€ì—ì„œ 3ê°œì˜ ì‘ì—…ë“¤ì´ ê°ê° ì“°ë ˆë“œì— í• ë‹¹ë˜ì–´ ìˆ˜í–‰ë˜ëŠ”ê²Œì•„ë‹Œ í•˜ë‚˜ì˜ ì“°ë ˆë“œì— í•˜ë‚˜ì”© ì‘ì—… í• ë‹¹ë° ì‘ì—…ì„ í•˜ë©° ëŒ€ê¸°í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.   
## ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œëŠ”  
newSingleThreadExecutor()## ê°€ ì•„ë‹Œ  
newFixedThreadFool(3)## ì„ í†µí•´ 3ê°œì˜ ì“°ë ˆë“œë¥¼ í• ë‹¹í•´ì£¼ë©´ 3ì´ˆê°€ ì¶œë ¥ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤  
## 3.  
## invokeAll  
## â‡’  
invokeAll()## ë©”ì†Œë“œëŠ” íƒœìŠ¤í¬ê°€ ëª¨ë‘ ëë‚ ë•Œê¹Œì§€ ê¸°ë‹¤ë ¸ë‹¤ê°€ ê°’ë“¤ì„ ë°˜í™˜í•©ë‹ˆë‹¤.  í•˜ì§€ë§Œ, ê°€ì¥ ë¨¼ì € ì™„ë£Œëœ ì‘ì—…ë§Œ ë°˜í™˜í•´ë„ ê´œì°®ë‹¤ë©´  
invokeAll## ì„ ì“°ê¸°ì—ëŠ” ì„±ëŠ¥ì´ ë–¨ì–´ì§‘ë‹ˆë‹¤.   
## ê·¸ëŸ´ ë•Œ ì‚¬ìš© í•  ìˆ˜ ìˆëŠ” ë©”ì†Œë“œê°€  
invokeAny## ì…ë‹ˆë‹¤.  ì´ ë•Œ ì£¼ì˜í•  ì ì€ Executorsì— ì“°ë ˆë“œê°€ í•˜ë‚˜ë§Œ í• ë‹¹ë˜ì–´ìˆë‹¤ë©´ ê²°êµ­ í•˜ë‚˜ê°€ ëë‚˜ì•¼ ë‹¤ìŒ ì‘ì—…ì´ ìˆ˜í–‰ë˜ëŠ”ë° ì´ ë•Œ ê°€ì¥ ì²˜ìŒ í• ë‹¹ë˜ëŠ” ì‘ì—…ì´ ì˜¤ë˜ê±¸ë¦¬ëŠ” ì‘ì—…ì´ë¼ë©´ íš¨ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ì ì ˆíˆ ì“°ë ˆë“œë¥¼ í• ë‹¹í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤.  
String result = executorService.invokeAny(Arrays.asList(hello, java, catsbi));  
System.out.println("result = " + result);  
Java## [ì‹¤í–‰ ê²°ê³¼]  
# 4. CompletableFuture 1  
  
# ê°œìš”  
## ìë°”ì—ì„œ ë¹„ë™ê¸°(Asynchronous)í”„ë¡œê·¸ë˜ë°ì„ ê°€ëŠ¥í•˜ê²Œí•˜ëŠ” ì¸í„°í˜ì´ìŠ¤.  
## Futureì˜ ì œì•½ì‚¬í•­ë“¤ì„ í•´ê²°í•œë‹¤.  
# Future ì œì•½  
# *   
## ì˜ˆì™¸ ì²˜ë¦¬ìš© APIë¥¼ ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.  
# *   
## ì—¬ëŸ¬ Futureë¥¼ ì¡°í•©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ex: Eventì •ë³´ë¥¼ ë°›ì•„ ë‹¤ìŒ Eventì— ì°¸ì„í•  íšŒì›ëª©ë¡ì¡°íšŒ)  
# *   
## Futureë¥¼ ì™¸ë¶€ì—ì„œ ì™„ë£Œì‹œí‚¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì·¨ì†Œí•˜ê±°ë‚˜, get()ì— íƒ€ì„ì•„ì›ƒì„ ì„¤ì •í•  ìˆ˜ëŠ” ìˆë‹¤.  
# *   
get()## ì„ í˜¸ì¶œí•˜ê¸° ì „ê¹Œì§€ëŠ”  
future## ë¥¼ ë‹¤ë£° ìˆ˜ ì—†ìŠµë‹ˆë‹¤.  
ExecutorService executorService = Executors.newFixedThreadPool(4);  
Future<String> future = executorService.submit(() -> "hello");  
...//TODO  
future.get();  
...//TODO  
Java## â‡’ ì—¬ê¸°ì„œ  
future## ëŠ”  
blocking call## ì…ë‹ˆë‹¤.  ì´ ë§ì€ futureë¥¼ get()ìœ¼ë¡œ ê°€ì ¸ì˜¤ëŠ” ë™ì•ˆì—ëŠ” ë‹¤ë¥¸ ì‘ì—…ë“¤ì˜ ìˆ˜í–‰ì´ ì•ˆëœë‹¤ëŠ” ì˜ë¯¸ì´ê³  ê·¸ ê¸°ê°„ì´ ê¸¸ì–´ì§ˆìˆ˜ë¡ ì„±ëŠ¥ì€ ë–¨ì–´ì§ˆìˆ˜ë°–ì— ì—†ìŠµë‹ˆë‹¤.  
# CompletableFuture  
# *   
## Futureì™€ CompletionStageë¥¼ êµ¬í˜„í•˜ëŠ” êµ¬í˜„ì²´  
  
  
![]({{ site.url }}{{ site.baseurl }}/assets/images/c9bb1a39a0b94d1e3e396948b11412c2/%E1%84%8B%E1%85%A1%E1%86%AF%20%E1%84%89%E1%85%AE%20%E1%84%8B%E1%85%A5%E1%86%B9%E1%84%8B%E1%85%B3%E1%86%B7.gif)  
## public class CompletableFuture<T> implements Future<T>, CompletionStage<T>{...}  
CompletableFuture<String> future = new CompletableFuture<>();  
future.complete("catsbi");  
System.out.println("future = " + future.get());  
//-------------OR --------------  
CompletableFuture<String> future = CompletableFuture.completedFuture("catsbi");  
System.out.println("future = " + future.get());  
Java  
# ë¹„ë™ê¸°ë¡œ ì‘ì—… ì‹¤í–‰í•˜ê¸°  
# *   
## ë¦¬í„´ê°’ì´ ì—†ëŠ” ê²½ìš°::  
runAsync()  
CompletableFuture<Void> future = CompletableFuture.runAsync(() -> {  
    System.out.println("Hello" + Thread.currentThread().getName());  
});  
future.get();  
Java  
# *   
## ë¦¬í„´ê°’ì´ ìˆëŠ” ê²½ìš°::  
supplyAsync()  
CompletableFuture<String> future = CompletableFuture.supplyAsync(() -> {  
    System.out.println("Hello" + Thread.currentThread().getName());  
    return "Hello";  
});  
future.get();  
Java  
# ì½œë°± ì œê³µí•˜ê¸°  
# *   
## ë¦¬í„´ê°’ì„ ë°›ì•„ì„œ ë‹¤ë¥¸ ê°’ìœ¼ë¡œ ë°”ê¾¸ëŠ” ì½œë°±  
  
  
![]({{ site.url }}{{ site.baseurl }}/assets/images/c9bb1a39a0b94d1e3e396948b11412c2/%E1%84%8B%E1%85%A1%E1%86%AF%20%E1%84%89%E1%85%AE%20%E1%84%8B%E1%85%A5%E1%86%B9%E1%84%8B%E1%85%B3%E1%86%B7%202.gif)  
## thenApply(Function)  
	CompletableFuture<String> future = CompletableFuture.supplyAsync(() -> {  
    System.out.println("Hello" + Thread.currentThread().getName());  
    return "Hello";  
}).thenApply((s)->{  
    System.out.println("content: "+s);  
    System.out.println(Thread.currentThread().getName());  
    return "HelloAsync";  
});  
System.out.println(future.get());  
Java## â‡’  
Javascript## ì˜  
Promise## ì™€ ìœ ì‚¬í•œ í˜•íƒœì…ë‹ˆë‹¤.  
supplyAsync## ì˜ ëŒë‹¤í‘œí˜„ì‹ì—ì„œ ë°˜í™˜ëœ  
Hello## ë¼ëŠ” ê°’ì€ ì²´ì´ë‹ëœ ë©”ì†Œë“œ  
thenApply## ì˜ ì¸ìê°’ìœ¼ë¡œ ë“¤ì–´ê°€ê³  ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ë” ì´ìƒ ì²´ì´ë‹ëœ ë©”ì†Œë“œê°€ ì—†ê¸°ì—  
return## ê°’ì¸  
HelloAsync## ëŠ” ë°˜í™˜ë˜ì–´  
future## ë¡œ ë“¤ì–´ê°€ê³   
get()## ì„í†µí•´ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
# *   
## ë¦¬í„´ê°’ì„ ë°›ì•„ ë˜ ë‹¤ë¥¸ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ”ë° ë°˜í™˜ê°’ì€ ì—†ëŠ” ì½œë°±  
  
  
![]({{ site.url }}{{ site.baseurl }}/assets/images/c9bb1a39a0b94d1e3e396948b11412c2/%E1%84%8B%E1%85%A1%E1%86%AF%20%E1%84%89%E1%85%AE%20%E1%84%8B%E1%85%A5%E1%86%B9%E1%84%8B%E1%85%B3%E1%86%B7%203.gif)  
## thenAccept(Consumer)  
CompletableFuture<Void> future = CompletableFuture.supplyAsync(() -> {  
    System.out.println("Hello" + Thread.currentThread().getName());  
    return "Hello";  
}).thenAccept((s)->{  
    System.out.println("content: "+s);  
    System.out.println(Thread.currentThread().getName());  
  
});  
future.get();  
Java  
# *   
## ë¦¬í„´ê°’ì„ ë°›ì§€ ì•Šê³  ë‹¤ë¥¸ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ì½œë°±  
  
  
![]({{ site.url }}{{ site.baseurl }}/assets/images/c9bb1a39a0b94d1e3e396948b11412c2/%E1%84%8B%E1%85%A1%E1%86%AF%20%E1%84%89%E1%85%AE%20%E1%84%8B%E1%85%A5%E1%86%B9%E1%84%8B%E1%85%B3%E1%86%B7%204.gif)  
## thenRun(Runnable)  
CompletableFuture<Void> future = CompletableFuture.supplyAsync(() -> {  
    System.out.println("Hello" + Thread.currentThread().getName());  
    return "hello";  
}).thenRun(()->{  
    System.out.println(Thread.currentThread().getName());  
});  
future.get();  
Java  
# ì–´ë–»ê²Œ thread poolì„ ë§Œë“¤ì§€ ì•Šê³  ë³„ë„ì˜ ì“°ë ˆë“œì—ì„œ ë™ì‘í•˜ëŠ”ê°€  
  
![]({{ site.url }}{{ site.baseurl }}/assets/images/c9bb1a39a0b94d1e3e396948b11412c2/%E1%84%8B%E1%85%A1%E1%86%AF%20%E1%84%89%E1%85%AE%20%E1%84%8B%E1%85%A5%E1%86%B9%E1%84%8B%E1%85%B3%E1%86%B7%205.gif)  
## : because of  
ForkJoinPool## â‡’ Dequeueë¥¼ ì‚¬ìš©í•´ ìì‹ ì˜ ì“°ë ˆë“œê°€ í•  ì¼ì´ ì—†ì„ ê²½ìš° Dequeueì—ì„œ í•  ì¼ì„ ê°€ì ¸ì™€ì„œ ì²˜ë¦¬ë¥¼ í•˜ëŠ” ë°©ì‹ì˜ í”„ë ˆì„ì›Œí¬  
## ì´ëŸ° ë°©ì‹ìœ¼ë¡œ CommonPoolì´ë¼ëŠ” ê³³ì—ì„œ ì“°ë ˆë“œë¥¼ ê°€ì ¸ì™€ ì‚¬ìš©í•©ë‹ˆë‹¤.  ë¬¼ë¡ , ì—¬ê¸°ì„œ ë”°ë¡œ êµ¬í˜„í•œ ì“°ë ˆë“œë¥¼ í• ë‹¹í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.  
ExecutorService executorService = Executors.newFixedThreadPool(4);  
CompletableFuture<Void> future = CompletableFuture.supplyAsync(() -> {  
    System.out.println("Hello" + Thread.currentThread().getName());  
    return "hello";  
}, executorService).thenRunAsync(()->{  
    System.out.println(Thread.currentThread().getName());  
}, executorService);  
future.get();  
executorService.shutdown();  
Java## 1.  
## ExecutorService executorService = Executors.newFixedThreadPool(4);  
## â‡’ CompletableFutureì—ì„œ ì‚¬ìš©í•  ì“°ë ˆë“œí’€ì„ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.   
## 2.  
## CompletableFuture.supplyAsync(() -> {...}, executorService)  
## â‡’ íŒŒë¼ë¯¸í„°ë¡œ ë³„ë„ì˜ ì“°ë ˆë“œ í’€ì„ ë„£ì–´ì£¼ë©´ í•´ë‹¹ ì“°ë ˆë“œí’€ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.  
runAsync## ì—ì„œë„ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.  
## 3.  
## .thenRunAsync(()->{...}, executorService);  
## â‡’ë³„ë„ì˜ ì“°ë ˆë“œí’€ì„ ì‚¬ìš©í•˜ê³ ì‹¶ìœ¼ë©´ ê¸°ì¡´ì˜ ì½œë°±ë©”ì†Œë“œ ì˜ ì ‘ë¯¸ì‚¬(suffix)ë¡œ  
Async## ë¥¼ ë¶™í˜€ì„œ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤(ex:  
thenRunAsync## ,  
thenAcceptAsync## ,  
thenApplyAsync## )  
# 5. CompletableFuture 2  
  
# CompletableFuture ì¡°í•© ë©”ì†Œë“œ  
## 1.  
## thenCompose()  
## â‡’ ë‘ ì‘ì—…ì´ ì„œë¡œ ì´ì–´ì„œ ì‹¤í–‰í•˜ë„ë¡ ì¡°í•©í•˜ë©° ì—°ê´€ëœ futureê°„ì— ë§ì´ ì‚¬ìš©í•©ë‹ˆë‹¤.  
public class App {  
    public static void main(String[] args) throws InterruptedException, ExecutionException {  
        CompletableFuture<String> helloFuture = CompletableFuture.supplyAsync(() -> {  
            System.out.println("Hello " + Thread.currentThread().getName());  
            return "Hello";  
        });  
  
        CompletableFuture<String> future = helloFuture.thenCompose(App::getWorldFuture);  
        System.out.println(future.get());  
  
    }  
    private static CompletableFuture<String> getWorldFuture(String message) {  
        return CompletableFuture.supplyAsync(() -> {  
            System.out.println("World " + Thread.currentThread().getName());  
            return message + " World";  
        });  
    }  
}  
Java## [ì‹¤í–‰ ê²°ê³¼]  
  
## 2.  
## thenCombine()  
## â‡’ ë‘ ì‘ì—…ì„ ë…ë¦½ì ìœ¼ë¡œ ì‹¤í–‰í•˜ê³  ë‘˜ ë‹¤ ì¢…ë£Œ í–ˆì„ë•Œ ì½œë°± ì‹¤í–‰í•©ë‹ˆë‹¤.  
public static void main(String[] args) throws InterruptedException, ExecutionException {  
    CompletableFuture<String> msFuture = CompletableFuture.supplyAsync(() -> {  
        System.out.println("MicroSoft " + Thread.currentThread().getName());  
        return "MicroSoft";  
    });  
  
    CompletableFuture<String> appleFuture = CompletableFuture.supplyAsync(() -> {  
        System.out.println("Apple " + Thread.currentThread().getName());  
        return "Apple";  
    });  
  
    CompletableFuture<String> resultFuture =   
									msFuture.thenCombine(appleFuture, (i, j) -> i + " " + j);  
    System.out.println(resultFuture.get());  
}  
Java## 3.  
## allOf()  
## â‡’ì—¬ëŸ¬ ì‘ì—…ì„ ëª¨ë‘ ì‹¤í–‰í•˜ê³  ëª¨ë“  ì‘ì—… ê²°ê³¼ì— ì½œë°± ì‹¤í–‰  
public static void main(String[] args) throws InterruptedException, ExecutionException {  
    CompletableFuture<String> msFuture = CompletableFuture.supplyAsync(() -> {  
        System.out.println("MicroSoft " + Thread.currentThread().getName());  
        return "MicroSoft";  
    });  
  
    CompletableFuture<String> appleFuture = CompletableFuture.supplyAsync(() -> {  
        System.out.println("Apple " + Thread.currentThread().getName());  
        return "Apple";  
    });  
    List<CompletableFuture<String>> futures = Arrays.asList(msFuture, appleFuture);  
  
    CompletableFuture<List<String>> results =  
            CompletableFuture.allOf(futures.toArray(new CompletableFuture[futures.size()]))  
                    .thenApply(v -> futures.stream()  
                            .map(CompletableFuture::join)  
                            .collect(Collectors.toList()));  
    results.get().forEach(System.out::println);  
}  
Java## 4.  
## anyOf()  
## â‡’ ì—¬ëŸ¬ ì‘ì—… ì¤‘ ê°€ì¥ ëë‚œ í•˜ë‚˜ì˜ ê²°ê³¼ë¥¼ ì½œë°±ì— ë„˜ê²¨ ì‹¤í–‰í•©ë‹ˆë‹¤.  
CompletableFuture<String> msFuture = CompletableFuture.supplyAsync(() -> {  
    System.out.println("MicroSoft " + Thread.currentThread().getName());  
    return "MicroSoft";  
});  
  
CompletableFuture<String> appleFuture = CompletableFuture.supplyAsync(() -> {  
    System.out.println("Apple " + Thread.currentThread().getName());  
    return "Apple";  
});  
  
CompletableFuture<Void> future = CompletableFuture.anyOf(msFuture, appleFuture).thenAccept(System.out::println);  
future.get();  
Java  
# ì˜ˆì™¸ ì²˜ë¦¬ ë©”ì†Œë“œ  
## 1.  
## exeptionally(Function)  
boolean throwError = true;  
  
CompletableFuture<String> msFuture = CompletableFuture.supplyAsync(() -> {  
    if (throwError) {  
        throw new IllegalArgumentException();  
    }  
  
    System.out.println("MicroSoft " + Thread.currentThread().getName());  
    return "MicroSoft";  
}).exceptionally(ex->{  
    System.out.println(ex);  
    return "Error";  
});  
  
System.out.println(msFuture.get());  
Java## [ì‹¤í–‰ ê²°ê³¼]  
  
## 2.  
## handle(BiFunction)  
boolean throwError = false;  
  
CompletableFuture<String> msFuture = CompletableFuture.supplyAsync(() -> {  
    if (throwError) {  
        throw new IllegalArgumentException();  
    }  
  
    System.out.println("MicroSoft " + Thread.currentThread().getName());  
    return "MicroSoft";  
}).handle((result, ex)->{  
    if (Objects.nonNull(ex)) {  
        System.out.println(ex);  
        return "ERROR";  
    }  
    return result;  
});  
  
System.out.println(msFuture.get());  
Java  
