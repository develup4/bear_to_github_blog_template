---
title:  ğŸƒSpring Bean Validationê³¼ API ì˜ˆì™¸ ì²˜ë¦¬

categories: ìŠ¤í”„ë§ë¶€íŠ¸ 
tags: backend  java  bean  validation
 
toc: true
toc_sticky: true
---

  
## Bean Validation  
- íŠ¹ì • í•„ë“œì— ëŒ€í•œ ê²€ì¦ ë¡œì§ì€ ëŒ€ë¶€ë¶„ ë¹ˆ ê°’ì¸ì§€ ì•„ë‹Œì§€, íŠ¹ì • í¬ê¸°ë¥¼ ë„˜ëŠ”ì§€ ì•„ë‹Œì§€ì™€ ê°™ì´ ë§¤ìš° ì¼ë°˜ì ì¸ ë¡œì§ì´ë‹¤.  
- ì• ë…¸í…Œì´ì…˜ì„ í†µí•´ì„œ ê²€ì¦ë¡œì§ì„ ì‘ì„±í•  ìˆ˜ ìˆë„ë¡ í‘œì¤€í™”í•œ ê²ƒì´ `Bean Validation`ì´ë‹¤.  
  
### ì˜ì¡´ê´€ê³„ ì¶”ê°€  
- `org.springframework.boot:spring-boot-starter-validation`  
  
### ì‚¬ìš©ë¡€  
  
```java  
public class Item {  
  
	private Long id;  
  
	@NotBlank  
	private String itemName;  
  
	@NotNull  
	@Range(min = 1000, max = 1000000)  
	private Integer price;  
  
	@NotNull  
	@Max(9999)  
	private Integer quantity;  
}  
```  
  
  
### ValidatorFactory  
- ìŠ¤í”„ë§ì—ì„œëŠ” ì§ì ‘ ì‚¬ìš©í•  ì¼ì´ ì—†ì§€ë§Œ ì°¸ê³ ë¡œ ì•Œì•„ë‘”ë‹¤.  
  
```java  
ValidatorFactory factory = Validation.buildDefaultValidatorFactory();  
Validator validator = factory.getValidator();  
  
Set<ConstraintViolation<Item>> violations = validator.validate(item)  
for (ConstraintViolation<Item> violation : violations) {  
	violation.getMessage();	// ex: violation.message=1000ì—ì„œ 1000000 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤  
}  
```  
  
## ìŠ¤í”„ë§ê³¼ Bean Validator  
- `spring-boot-starter-validation` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë„£ìœ¼ë©´ ìŠ¤í”„ë§ ë¶€íŠ¸ê°€ ìë™ìœ¼ë¡œ Bean Validatorë¥¼ ì¸ì§€í•˜ê³  `LocalValidatorFactoryBean`ì„ ê¸€ë¡œë²Œ Validatorë¡œ ë“±ë¡í•œë‹¤.  
- `@Valid`ë‚˜ `@Validated` ì• ë…¸í…Œì´ì…˜ì„ í†µí•´ ê²€ì¦í•  ìˆ˜ ìˆë‹¤. ì „ìëŠ” ìë°” í‘œì¤€, í›„ìëŠ” ìŠ¤í”„ë§ì—ì„œ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì´ë‹¤.  
  
### ì˜ˆì œ  
  
```java  
@PostMapping("/add")  
public String addItem(@Validated @RequestBody Dto dto, BindingResult bindingResult) {  
	if (bindingResult.hasError()) {  
		log.info(bindingResult);  
		return bindingResult.getAllErrors();  
	}  
}  
```  
  
- ì‚¬ìš©ë²•ì„ ìœ„í•œ ì¸ìœ„ì ì¸ ì˜ˆì œì´ë‹¤. ì‹¤ì œë¡œëŠ” Requestê°€ Dtoë¡œ ë³€í™˜ìì²´ê°€ ì•ˆë˜ì„œ í•¸ë“¤ëŸ¬ ì•ˆìœ¼ë¡œ ë“¤ì–´ê°€ì§€ ëª»í•˜ê³  ì´ë¯¸ ì‹¤íŒ¨í•˜ê²Œ ëœë‹¤.  
  
  
## API ì˜ˆì™¸ ì²˜ë¦¬  
- ì˜ˆì™¸ë¥¼ ë˜ì¡Œì„ë•Œ(throw) ì• í”Œë¦¬ì¼€ì´ì…˜ ë‚´ë¶€ì—ì„œ ì•„ë¬´ë„ ê·¸ê²ƒì„ ì²˜ë¦¬í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ì–´ë–»ê²Œ ë ê¹Œ?  
- ì˜ˆì™¸ëŠ” ì„œë¸”ë¦¿ì„ í˜¸ì¶œí•œ WASê¹Œì§€ ì „ë‹¬ëœë‹¤. ê·¸ë¦¬ê³  MVCì˜ ê²½ìš° ì˜ˆì™¸ í˜ì´ì§€, APIì˜ ê²½ìš° 500ë²ˆëŒ€ì˜ ì„œë²„ ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¨ë‹¤.  
- ì˜ˆì™¸ì˜ ê¸°ë³¸ì²˜ë¦¬ëŠ” `response.sendError(statusCode, reason)`ì„ í†µí•´ WASì— ì „ë‹¬ë˜ê³ , ë‹¤ì‹œ ì„œë¸”ë¦¿ì„ í†µí•´ ì—ëŸ¬í˜ì´ì§€ í˜¹ì€ ì—ëŸ¬ì²˜ë¦¬ ì„œë¸”ë¦¿ì´ í˜¸ì¶œë˜ëŠ” êµ¬ì¡°ì´ë‹¤.  
- ë””í…Œì¼í•˜ê²Œ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ìŠ¤í”„ë§ì—ì„œëŠ” `ExceptionResolver`ë¥¼ ì œê³µí•œë‹¤.  
  
### ExceptionResolver  
- ìš°ì„ ìˆœìœ„ëŠ” `ExceptionHandlerExceptionResolver`,  `ResponseStatusExceptionResolver`, `DefaultHandlerExceptionResolver`ìˆœì´ë‹¤.  
  
#### DefaultHandlerExceptionResolver  
- ìŠ¤í”„ë§ ë‚´ë¶€ì˜ ê¸°ë³¸ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•œë‹¤.  
  
#### ResponseStatusExceptionResolver  
- ì˜ˆì™¸ì— ë”°ë¼ HTTP Status ì½”ë“œë¥¼ ì§€ì •í•´ì£¼ëŠ” ì—­í• ì„ í•œë‹¤.  
- `@ResponseStatus`ê°€ ë‹¬ë ¤ìˆëŠ” ì˜ˆì™¸, `ResponseStatusException` ì˜ˆì™¸ ë“±ì„ ì²˜ë¦¬í•œë‹¤.  
- ë‚´ë¶€ êµ¬í˜„ì ìœ¼ë¡œëŠ” ì´ê²ƒë„ `sendError()`ë¥¼ í†µí•´ ë‹¤ì‹œ ì„œë¸”ë¦¿ì´ í˜¸ì¶œë˜ëŠ” êµ¬ì¡°ì´ë‹¤.  
  
```java  
// @ResponseStatus  
@ResponseStatus(code = HttpStatus.BAD_REQUEST, reason = "ì˜ëª»ëœ ìš”ì²­ ì˜¤ë¥˜")  
public class BadRequestException extends RuntimeException {  
  
}  
  
// ResponseStatusException - ë¼ì´ë¸ŒëŸ¬ë¦¬ ë“± ì˜ˆì™¸ë¥¼ ì§ì ‘ ìˆ˜ì •í•˜ê¸° ì–´ë ¤ìš´ ê²½ìš° ì‚¬ìš©  
@GetMapping("/responseExceptionTest")  
public String responseStatusExample() {  
	throw new ResponseStatusException(HttpStatus.NOT_FOUND, "error", new IllegalArgumentException());  
}  
```  
  
#### ExceptionHandlerExceptionResolver  
- ê°€ì¥ ìš°ì„ ìˆœìœ„ê°€ ë†’ê³  ê°€ì¥ ë§ì´ ì‚¬ìš©ë˜ëŠ” ë°©ì‹ì´ë‹¤.  
- ì§€ì •í•œ ì˜ˆì™¸ ë˜ëŠ” **ê·¸ ì˜ˆì™¸ì˜ ìì‹** í´ë˜ìŠ¤ë¥¼ ëª¨ë‘ ì¡ì„ ìˆ˜ ìˆë‹¤.  
  
```java  
@RestController  
public class ApiExceptionController {  
  
	// ì»¨íŠ¸ë¡¤ëŸ¬ ë‚´ì— ì˜ˆì™¸ì²˜ë¦¬ í´ë˜ìŠ¤ ì •ì˜  
	@ResponseStatus(HttpStatus.BAD_REQUEST)  
	@ExceptionHandler(IllegalArgumentException.class)		// ì˜ˆì™¸ í´ë˜ìŠ¤ëŠ” ìƒëµí•  ìˆ˜ ìˆë‹¤.  
	public ErrorResult illegalExHandler(IllegalArgumentException e) {  
		log.error(e);  
		return new ErrorResult("BAD", e.getMessage());  
	}  
  
	// ë™ì ìœ¼ë¡œ ìƒíƒœì½”ë“œë¥¼ ë³€ê²½í•˜ê³  ì‹¶ì„ ë•Œ  
	@ExceptionHandler(IllegalArgumentException.class)		// ì˜ˆì™¸ í´ë˜ìŠ¤ëŠ” ìƒëµí•  ìˆ˜ ìˆë‹¤.  
	public ErrorResult illegalExHandler(IllegalArgumentException e) {  
		ErrorResult errorResult = new ErrorResult("BAD", e.getMessage());  
		return new ResponseEntity<>(errorResult, HttpStatus.BAD_REQUEST);  
	}  
  
	// API  
	@GetMapping("/responseExceptionTest")  
	public String responseStatusExample() {  
		throw new IllegalArgumentException("ì˜ëª»ëœ ì…ë ¥");  
	}  
}  
```  
  
- ìœ„ ì½”ë“œëŠ” APIë¥¼ ìœ„í•œ ì½”ë“œì™€ ì˜ˆì™¸ ì²˜ë¦¬ ì½”ë“œê°€ ì„ì—¬ìˆì–´ ì‘ì§‘ë„ê°€ ë–¨ì–´ì§„ë‹¤. ì´ëŸ° ê²½ìš° `@ControllerAdvice`, `@RestControllerAdvice` ë“±ì„ ì‚¬ìš©í•´ ë¶„ë¦¬í•  ìˆ˜ ìˆë‹¤.  
  
```java  
// ëŒ€ìƒì„ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ ëª¨ë“  ì»¨íŠ¸ë¡¤ëŸ¬ì— ê¸€ë¡œë²Œë¡œ ì ìš©  
@ControllerAdvice  
  
// íŠ¹ì • ì• ë…¸í…Œì´ì…˜ì„ ê°€ì§„ ì»¨íŠ¸ë¡¤ëŸ¬ì—ë§Œ ì ìš©í•˜ëŠ” ê²½ìš°  
@ControllerAdvice(annotations = RestController.class)  
  
// íŠ¹ì • íŒ¨í‚¤ì§€ ì•ˆì˜ ì»¨íŠ¸ë¡¤ëŸ¬ì—ë§Œ ì ìš©í•˜ëŠ” ê²½ìš°  
@ControllerAdvice("org.example.controllers")  
  
  
// íŠ¹ì • ì»¨íŠ¸ë¡¤ëŸ¬ì—ë§Œ ì ìš©í•˜ëŠ” ê²½ìš°  
@ControllerAdvice(assignableTypes = {ControllerInterface.class, AbsController.class})  
public class ApiExceptionAdvice {  
  
	@ResponseStatus(HttpStatus.BAD_REQUEST)  
	@ExceptionHandler(IllegalArgumentException.class)		// ì˜ˆì™¸ í´ë˜ìŠ¤ëŠ” ìƒëµí•  ìˆ˜ ìˆë‹¤.  
	public ErrorResult illegalExHandler(IllegalArgumentException e) {  
		log.error(e);  
		return new ErrorResult("BAD", e.getMessage());  
	}  
  
	// ë‹¤ë¥¸ ì˜ˆì™¸ ì²˜ë¦¬ ì½”ë“œ  
	// â€¦  
}  
  
```  
